---
title: Azure Service Bus komunikatów, ładunków i serializacji | Microsoft Docs
description: Ten artykuł zawiera omówienie Azure Service Bus komunikatów, ładunków, routingu wiadomości i serializacji.
services: service-bus-messaging
documentationcenter: ''
author: axisc
manager: timlt
editor: spelluru
ms.service: service-bus-messaging
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 01/24/2020
ms.author: aschhab
ms.openlocfilehash: 11e56ae2483a254fb00e3593da7841f3f3d844f3
ms.sourcegitcommit: b5d646969d7b665539beb18ed0dc6df87b7ba83d
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 01/26/2020
ms.locfileid: "76759401"
---
# <a name="messages-payloads-and-serialization"></a>Komunikaty, ładunki i serializacja

Microsoft Azure Service Bus obsługuje komunikaty. Komunikaty zawierają ładunek, a także metadane, w formie par klucz-wartość właściwości, opisując ładunku i dostarczając instrukcje obsługi Service Bus i aplikacji. Czasami metadane są wystarczające do przeprowadzenia informacji, które nadawca chce komunikować z odbiornikami, a ładunek pozostaje pusty.

Model obiektów oficjalnych klientów Service Bus dla programów .NET i Java odzwierciedla strukturę abstrakcyjnej Service Bus komunikatów, która jest mapowana na i z protokołów sieci Service Bus obsługiwanych przez program.
 
Komunikat Service Bus składa się z sekcji ładunków binarnych, która Service Bus nigdy nie dojścia w żadnej postaci po stronie usługi i dwóch zestawach właściwości. *Właściwości brokera* są wstępnie zdefiniowane przez system. Te wstępnie zdefiniowane właściwości kontrolują funkcje na poziomie wiadomości wewnątrz brokera lub mapują je na typowe i znormalizowane Elementy metadanych. *Właściwości użytkownika* to kolekcja par klucz-wartość, które mogą być definiowane i ustawiane przez aplikację.
 
Właściwości wstępnie zdefiniowanych brokera są wymienione w poniższej tabeli. Nazwy są używane ze wszystkimi oficjalnymi interfejsami API klienta, a także w obiekcie JSON [BrokerProperties](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage) mapowania protokołu HTTP.
 
Równoważne nazwy używane na poziomie protokołu AMQP są wyświetlane w nawiasach. 

| Nazwa właściwości                         | Opis                                                                                                                                                                                                                                                                                                                                                                                                                               |
|---------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|  [ContentType](/dotnet/api/microsoft.azure.servicebus.message.contenttype) (typ zawartości)           | Opcjonalnie opisuje ładunek wiadomości z deskryptorem następującym po formacie RFC2045, sekcja 5; na przykład `application/json`.                                                                                                                                                                                                                                                                                             |
|  Identyfikator [korelacji (](/dotnet/api/microsoft.azure.servicebus.message.correlationid#Microsoft_Azure_ServiceBus_Message_CorrelationId) korelacja)       | Umożliwia aplikacji określenie kontekstu wiadomości na potrzeby korelacji; na przykład odzwierciedlanie **MessageID** komunikatu, do którego odwołuje się odpowiedź.                                                                                                                                                                                                                                                                  |
| [DeadLetterSource](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.deadlettersource)                      | Ustawia się tylko w wiadomościach, które zostały utracone i następnie przesyłane z kolejki utraconych wiadomości do innej jednostki. Wskazuje jednostkę, w której wiadomość była utracona. Ta właściwość jest tylko do odczytu.                                                                                                                                                                                                                                  |
| [DeliveryCount](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.deliverycount)                         | Liczba prób dostarczenia dla tej wiadomości. Licznik jest zwiększany po wygaśnięciu blokady wiadomości lub komunikat został jawnie porzucony przez odbiornik. Ta właściwość jest tylko do odczytu.                                                                                                                                                                                                                                                  |
| [EnqueuedSequenceNumber](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.enqueuedsequencenumber)                | W przypadku wiadomości, które zostały przesłane ponownie, ta właściwość odzwierciedla numer sekwencyjny, który został po raz pierwszy przypisany do wiadomości w pierwotnym punkcie ich przesłania. Ta właściwość jest tylko do odczytu.                                                                                                                                                                                                                                                                |
| [EnqueuedTimeUtc](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.enqueuedtimeutc)                       | Czas UTC, w którym wiadomość została zaakceptowana i zapisana w jednostce. Ta wartość może być używana jako wskaźnik czasu dojazdu autorytatywnego i neutralnego, gdy odbiorca nie chce ufać zegarowi nadawcy. Ta właściwość jest tylko do odczytu.                                                                                                                                                                                                   |
|  [ExpiresAtUtc](/dotnet/api/microsoft.azure.servicebus.message.expiresatutc) (bezwzględnie-czas wygaśnięcia) | Czas UTC natychmiast, gdy wiadomość jest oznaczona do usunięcia i nie jest już dostępna do pobrania z jednostki ze względu na jej wygaśnięcie. Wygaśnięcie jest kontrolowane przez właściwość **TimeToLive** , a ta właściwość jest obliczana z EnqueuedTimeUtc + TimeToLive. Ta właściwość jest tylko do odczytu.                                                                                                                                                                           |
| [ForcePersistence](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.forcepersistence)                      | W przypadku kolejek lub tematów, które mają ustawioną flagę [EnableExpress](/dotnet/api/microsoft.servicebus.messaging.queuedescription.enableexpress) , tę właściwość można ustawić, aby wskazać, że komunikat musi zostać utrwalony na dysku przed potwierdzeniem. Jest to standardowe zachowanie dla wszystkich jednostek nieekspresowych.                                                                                                                                                                                                         |
| [Etykieta](/dotnet/api/microsoft.azure.servicebus.message.label) (temat)                       | Ta właściwość umożliwia aplikacji wskazywanie przeznaczenia wiadomości do odbiorcy w znormalizowany sposób, podobnie jak w przypadku wiersza tematu wiadomości e-mail.                                                                                                                                                                                                                                                                                  |
| [LockedUntilUtc](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.lockeduntilutc)                        | W przypadku komunikatów pobranych w ramach blokady (tryb odbioru z możliwością odczytu, niewstępnie rozliczone) ta właściwość odzwierciedla czas UTC natychmiast, dopóki wiadomość nie zostanie zablokowana w kolejce/subskrypcji. Po wygaśnięciu blokady [DeliveryCount](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.deliverycount) jest zwiększany, a komunikat jest ponownie dostępny do pobrania. Ta właściwość jest tylko do odczytu.                                                                                                                         |
| [LockToken](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.locktoken)                             | Token blokady jest odwołaniem do blokady, która jest utrzymywana przez brokera w trybie odbioru z *blokadą* . Token może służyć do trwałego przypięcia blokady przez interfejs API [odroczenia](message-deferral.md) i, z tym, przejmowanie komunikatu z przepływu stanu regularnego dostarczania. Ta właściwość jest tylko do odczytu.                                                                                                                                                               |
| [MessageID](/dotnet/api/microsoft.azure.servicebus.message.messageid) (Message-ID)                | Identyfikator komunikatu jest wartością zdefiniowaną przez aplikację, która jednoznacznie identyfikuje komunikat i jego ładunek. Identyfikator jest ciągiem o dowolnym formacie i może odzwierciedlać identyfikator GUID lub identyfikator pochodzący z kontekstu aplikacji. Jeśli ta opcja jest włączona, funkcja [wykrywania duplikatów](duplicate-detection.md) identyfikuje i usuwa drugą i więcej przesłanych komunikatów o tym samym **atrybucie MessageID**.                                                                |
| [PartitionKey](/dotnet/api/microsoft.azure.servicebus.message.partitionkey)                          | W przypadku [jednostek partycjonowanych](service-bus-partitioning.md)ustawienie tej wartości umożliwia przypisanie powiązanych komunikatów do tej samej partycji wewnętrznej, aby kolejność sekwencji przesłania była poprawnie rejestrowana. Partycja jest wybierana przez funkcję mieszania względem tej wartości i nie można jej wybrać bezpośrednio. W przypadku jednostek obsługujących sesję Właściwość **SessionID** zastępuje tę wartość.                                                                                                       |
| [ReplyTo](/dotnet/api/microsoft.azure.servicebus.message.replyto) (Odpowiedz do)                    | Ta opcjonalna i zdefiniowana przez aplikację wartość jest standardowym sposobem wyrażania ścieżki odpowiedzi do odbiorcy wiadomości. Gdy nadawca oczekuje odpowiedzi, ustawia wartość na ścieżkę bezwzględną lub względną kolejki lub tematu, która oczekuje na wysłanie odpowiedzi.                                                                                                                                           |
| [ReplyToSessionId](/dotnet/api/microsoft.azure.servicebus.message.replytosessionid) (Odpowiedz do grupy-ID)  | Ta wartość rozszerza informacje o **ReplyTo** i określa, który **Identyfikator sesji** należy ustawić dla odpowiedzi w przypadku wysłania do jednostki odpowiedzi.                                                                                                                                                                                                                                                                            |
| [ScheduledEnqueueTimeUtc](/dotnet/api/microsoft.azure.servicebus.message.scheduledenqueuetimeutc)               | W przypadku komunikatów, które są dostępne tylko do pobrania po opóźnieniu, ta właściwość definiuje czas UTC natychmiast, w którym komunikat będzie logicznie przestawiony w kolejce, sekwencyjny i udostępniony do pobrania.                                                                                                                                                                                                                 |
| [SequenceNumber](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.sequencenumber)                        | Numer sekwencyjny jest unikatowym 64-bitową liczbą całkowitą przypisaną do komunikatu, ponieważ jest akceptowany i przechowywany przez brokera i działa jako jego prawdziwy identyfikator. W przypadku jednostek partycjonowanych najwyżej 16 bitów odzwierciedla identyfikator partycji. Numery sekwencji monotonicznie zwiększają się i są gapless. Są one przenoszone do 0, gdy zostanie wyczerpany zakres 48-64 bitów. Ta właściwość jest tylko do odczytu.                                                                |
| Identyfikator [sesji](/dotnet/api/microsoft.azure.servicebus.message.sessionid) (ID grupy)                  | W przypadku jednostek z obsługą sesji ta wartość zdefiniowana przez aplikację określa przynależność sesji. Komunikaty z tym samym identyfikatorem sesji podlegają blokowaniu podsumowującemu i umożliwiają dokładne przetwarzanie i demultiplekserowanie w kolejności. W przypadku jednostek, które nie obsługują sesji, ta wartość jest ignorowana.                                                                                                                                     |
| [Rozmiar](/dotnet/api/microsoft.azure.servicebus.message.size)                                  | Odzwierciedla rozmiar przechowywanego komunikatu w dzienniku brokera w postaci liczby bajtów, ponieważ jest ono wliczane do limitu przydziału magazynu. Ta właściwość jest tylko do odczytu.                                                                                                                                                                                                                                                                                                       |
| [State](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.state)                                 | Wskazuje stan komunikatu w dzienniku. Ta właściwość ma zastosowanie tylko podczas przeglądania komunikatów ("wgląd") w celu określenia, czy komunikat jest "aktywny" i dostępny do pobrania, gdy dociera do początku kolejki, czy jest odroczony, czy oczekuje na zaplanowanie. Ta właściwość jest tylko do odczytu.                                                                                                                                           |
| [TimeToLive](/dotnet/api/microsoft.azure.servicebus.message.timetolive)                            | Ta wartość jest względnym czasem trwania, po upływie którego wygasa komunikat, rozpoczynając od natychmiastowego komunikatu, który został zaakceptowany i zapisany przez brokera, zgodnie z **EnqueueTimeUtc**. Gdy nie ustawiono jawnie, przyjęta wartość to **DefaultTimeToLive** dla odpowiedniej kolejki lub tematu. Wartość **TimeToLive** na poziomie komunikatu nie może być dłuższa niż ustawienie **DefaultTimeToLive** jednostki. Jeśli jest dłuższy, jest on w trybie dyskretnym. |
| [Do](/dotnet/api/microsoft.azure.servicebus.message.to) (do)                               | Ta właściwość jest zarezerwowana do użycia w przyszłości w scenariuszach routingu i obecnie ignorowana przez sam brokera. Aplikacje mogą używać tej wartości w scenariuszach opartych na regułach łańcucha autoprzesyłania dalej, aby wskazać zamierzone logiczne miejsce docelowe wiadomości.                                                                                                                                                                                   |
| [ViaPartitionKey](/dotnet/api/microsoft.azure.servicebus.message.viapartitionkey)                       | Jeśli wiadomość jest wysyłana za pośrednictwem kolejki transferu w zakresie transakcji, ta wartość wybiera partycję kolejki transferu.                                                                                                                                                                                                                                                                                                                 |

Model komunikatów abstrakcyjnych umożliwia opublikowanie komunikatu w kolejce za pośrednictwem protokołu HTTP (faktycznie zawsze HTTPS) i można go pobrać za pośrednictwem AMQP. W obu przypadkach komunikat wygląda normalnie w kontekście odpowiedniego protokołu. Właściwości brokera są tłumaczone zgodnie z potrzebami, a właściwości użytkownika są mapowane do najbardziej odpowiedniej lokalizacji w odpowiednim modelu komunikatów protokołu. W protokole HTTP właściwości użytkownika są mapowane bezpośrednio do i z nagłówków HTTP; w AMQP są mapowane na i z mapy **właściwości aplikacji** .

## <a name="message-routing-and-correlation"></a>Routing i Korelacja komunikatów

Podzbiór właściwości brokera opisanych [wcześniej, w szczególności](/dotnet/api/microsoft.azure.servicebus.message.to) [ReplyTo](/dotnet/api/microsoft.azure.servicebus.message.replyto), [ReplyToSessionId](/dotnet/api/microsoft.azure.servicebus.message.replytosessionid), [MessageID](/dotnet/api/microsoft.azure.servicebus.message.messageid), [korelacji](/dotnet/api/microsoft.azure.servicebus.message.correlationid)i [SessionID](/dotnet/api/microsoft.azure.servicebus.message.sessionid), służy do przesyłania komunikatów do określonych miejsc docelowych. Aby to zilustrować, weź pod uwagę kilka wzorców:

- **Proste żądanie/odpowiedź**: Wydawca wysyła komunikat do kolejki i oczekuje odpowiedzi od odbiorcy wiadomości. Aby odebrać odpowiedź, Wydawca jest właścicielem kolejki, w której oczekuje na dostarczenie odpowiedzi. Adres tej kolejki jest wyrażony we właściwości **ReplyTo** wiadomości wychodzącej. Gdy odbiorca odpowie, kopiuje wartość **MessageID** obsługiwanego komunikatu do właściwości **Identyfikator korelacji** komunikatu odpowiedzi i dostarcza komunikat do miejsca docelowego wskazanego przez właściwość **ReplyTo** . Jeden komunikat może zwracać wiele odpowiedzi, w zależności od kontekstu aplikacji.
- **Żądanie/odpowiedź multiemisji**: jako odmiana poprzedniego wzorca Wydawca wysyła wiadomość do tematu, a wielu subskrybentów staje się uprawniony do korzystania z wiadomości. Każdy subskrybent może odpowiedzieć w opisany wcześniej sposób. Ten wzorzec jest używany w scenariuszach odnajdywania lub wywoływać wywołania, a respondent zazwyczaj identyfikuje siebie przy użyciu właściwości użytkownika lub wewnątrz ładunku. Jeśli **ReplyTo** wskazuje temat, taki zbiór odpowiedzi odnajdywania może być dystrybuowany do odbiorców.
- **Multipleksowanie**: Ta funkcja sesji umożliwia multipleksowanie strumieni powiązanych komunikatów za pomocą pojedynczej kolejki lub subskrypcji w taki sposób, że każda sesja (lub Grupa) powiązanych komunikatów, identyfikowane przez pasujące wartości **SessionID** , są kierowane do określonego odbiornika, gdy odbiornik utrzymuje sesję w obszarze blokada. Więcej informacji na temat sesji można znaleźć [tutaj](message-sessions.md).
- **Multiplexed żądanie/odpowiedź**: Ta funkcja sesji włącza Multipleksery odpowiedzi, umożliwiając kilku wydawcom współużytkowanie kolejki odpowiedzi. Ustawiając **ReplyToSessionId**, Wydawca może nakazać odbiorcom skopiowanie tej wartości do właściwości **SessionID** komunikatu odpowiedzi. Kolejka lub temat publikacji nie musi być oparty na sesji. Po wysłaniu wiadomości Wydawca może następnie odczekać na sesję z danym **identyfikatorem** sesji, aby zmaterializowania w kolejce przez warunkowe zaakceptowanie odbiorcy sesji. 

Routing wewnątrz przestrzeni nazw Service Bus można zrealizować przy użyciu łańcucha automatycznego przesyłania dalej i reguł subskrypcji tematu. Routing między przestrzeniami nazw można zrealizować [przy użyciu usługi Azure LogicApps](https://azure.microsoft.com/services/logic-apps/). Jak wskazano na poprzedniej liście, właściwość **do** jest zarezerwowana do użytku w przyszłości i może być interpretowana przez brokera przy użyciu specjalnie włączonej funkcji. Aplikacje, które chcą zaimplementować Routing, powinny być wykonywane na podstawie właściwości użytkownika, a nie do produkcji na właściwości **do** ; wykonanie tej operacji nie spowoduje jednak problemów ze zgodnością.

## <a name="payload-serialization"></a>Serializacja ładunku

Gdy podczas przesyłania lub przechowywania wewnątrz Service Bus, ładunek jest zawsze nieprzezroczystym blokiem binarnym. Właściwość [ContentType](/dotnet/api/microsoft.azure.servicebus.message.contenttype) umożliwia aplikacjom opisywanie ładunku przy użyciu sugerowanego formatu wartości właściwości w opisie typu zawartości MIME zgodnie z IETF RFC2045; na przykład `application/json;charset=utf-8`.

W przeciwieństwie do wariantów Java lub .NET Standard, wersja .NET Framework interfejsu API Service Bus obsługuje tworzenie wystąpień **BrokeredMessage** przez przekazanie dowolnego obiektu .NET do konstruktora. 

W przypadku korzystania ze starszego protokołu SBMP te obiekty są następnie serializowane przy użyciu domyślnego serializatora binarnego lub z serializatorem, który jest dostarczany zewnętrznie. W przypadku korzystania z protokołu AMQP obiekt jest serializowany do obiektu AMQP. Odbiornik może pobrać te obiekty za pomocą metody [GetBody\<t > ()](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.getbody#Microsoft_ServiceBus_Messaging_BrokeredMessage_GetBody__1) , dostarczając oczekiwany typ. W przypadku AMQP obiekty są serializowane do grafu AMQP **ArrayList** i **IDictionary < ciągu, obiektów >** obiekty i dowolnego klienta AMQP można zdekodować. 

Mimo że ukryty magiczny serializacji jest wygodny, aplikacje powinny przejąć jawną kontrolę serializacji obiektu i przekształcić wykresy obiektów w strumienie przed dołączeniem ich do wiadomości, a następnie wykonać odwracanie po stronie odbiornika. Zapewnia to nieobsługiwane wyniki. Należy również zauważyć, że podczas gdy AMQP ma zaawansowany model kodowania binarny, jest on powiązany z ekosystemem obsługi komunikatów AMQP i klienci HTTP będą mogli rozkodować takie ładunki. 

Ogólnie zalecamy używanie formatu JSON i Apache Avro jako formatów ładunków dla danych strukturalnych.

Warianty interfejsów API .NET Standard i Java akceptują tylko tablice bajtowe, co oznacza, że aplikacja musi obsługiwać kontrolę serializacji obiektu. 

## <a name="next-steps"></a>Następne kroki

Aby dowiedzieć się więcej na temat Service Bus Messaging, zobacz następujące tematy:

* [Kolejki, tematy i subskrypcje usługi Service Bus](service-bus-queues-topics-subscriptions.md)
* [Wprowadzenie do kolejek usługi Service Bus](service-bus-dotnet-get-started-with-queues.md)
* [Jak używać tematów i subskrypcji usługi Service Bus](service-bus-dotnet-how-to-use-topics-subscriptions.md)
